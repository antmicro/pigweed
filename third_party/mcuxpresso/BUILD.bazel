# Copyright 2023 The Pigweed Authors
#
# Licensed under the Apache License, Version 2.0 (the "License"); you may not
# use this file except in compliance with the License. You may obtain a copy of
# the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations under
# the License.
load("@pigweed//third_party/mcuxpresso:mcuxpresso_sdk.bzl", "mcuxpresso_sdk")

package(default_visibility = ["//visibility:public"])

licenses(["notice"])

cc_library(
    name = "default_mcuxpresso_sdk",
    # The "default" config is not compatible with any configuration: you can't
    # build MCUXpresso targets without choosing an SDK.
    target_compatible_with = ["@platforms//:incompatible"],
)

cc_library(
    name = "conf",
    defines = [
        "CPU_MIMXRT595SFFOC_cm33",
        "DEBUG_CONSOLE_DISABLE_RTOS_SYNCHRONIZATION",
        "FSL_RTOS_FREE_RTOS",
        "FSL_SDK_DRIVER_QUICK_ACCESS_ENABLE=1",
        "SDK_DEBUGCONSOLE=1",
        "SDK_OS_FREE_RTOS",
        "SDK_DEBUGCONSOLE=1",
        "DEBUG_CONSOLE_TRANSFER_NON_BLOCKING",
        "USB_STACK_USE_DEDICATED_RAM=1",
        "FSL_OSA_BM_TASK_ENABLE=0",
        "FSL_OSA_BM_TIMER_CONFIG=0",
        "__STDC_FORMAT_MACROS",
        "_GLIBCXX_HAVE_INTTYPES_H",
        "__int64_t_defined",
    ],
    includes = ["config"],
    hdrs = [
        "config/ffconf.h",
        "config/usb_host_config.h",
        "config/wifi_config.h",
        "config/wifi_bt_module_config.h",
        "config/sdmmc_config.h",
        "config/clock_config.h",
        "config/board.h",
        "config/wifi_bt_config.h",
        "config/edgefast_bluetooth_config.h",
        "config/peripherals.h",
        "config/pin_mux.h",
    ],
)

exports_files(["config/app_bluetooth_config.h"])

mcuxpresso_sdk(
    name = "mcuxpresso_sdk",
    mcuxpresso_sdk = "@mcuxpresso",
    manifest = "@mcuxpresso//:manifests/EVK-MIMXRT595_manifest_v3_14.xml",
    include = [
        "component.serial_manager_uart.MIMXRT595S",
        "platform.drivers.flexcomm_i2c.MIMXRT595S",
        "platform.drivers.flexcomm_spi.MIMXRT595S",
        "platform.drivers.flexcomm_usart_dma.MIMXRT595S",
        "platform.drivers.flexcomm_usart_freertos.MIMXRT595S",
        "platform.drivers.flexio_spi.MIMXRT595S",
        "platform.drivers.inputmux.MIMXRT595S",
        "platform.drivers.lpc_dma.MIMXRT595S",
        "platform.drivers.lpc_gpio.MIMXRT595S",
        "platform.drivers.lpc_iopctl.MIMXRT595S",
        "platform.drivers.flexspi.MIMXRT595S",
        "platform.drivers.mu.MIMXRT595S",
        "platform.drivers.pint.MIMXRT595S",
        "platform.drivers.power.MIMXRT595S",
        "platform.drivers.common.MIMXRT595S",
        "platform.drivers.cache_cache64.MIMXRT595S",
        "platform.drivers.flash_config.evkmimxrt595.MIMXRT595S",
        "utility.debug_console.MIMXRT595S",
        "device.MIMXRT595S_CMSIS.MIMXRT595S",
        "middleware.wifi.fwdnld_intf_abs.MIMXRT595S",
        "middleware.edgefast_bluetooth.wifi_nxp.controller.base.MIMXRT595S",
        "middleware.edgefast_bluetooth.ble.ethermind.cm33.MIMXRT595S",
        "middleware.usb.device_controller_ip3511hs.MIMXRT595S",
        "middleware.usb.phy.MIMXRT595S",
        "middleware.usb.device.controller.driver.MIMXRT595S",
        "middleware.usb.device.ip3511hs_config_header.MIMXRT595S",
        "middleware.usb.device.common_header.MIMXRT595S",
        "middleware.usb.common_header.MIMXRT595S",
    ],
    exclude = [
        "device.MIMXRT595S_startup.MIMXRT595S",
        "component.osa.MIMXRT595S",
        "middleware.sdmmc.sdhc.template.MIMXRT595S",
        "middleware.sdmmc.sdif.template.MIMXRT595S",
        "middleware.sdmmc.usdhc.template.MIMXRT595S",
        "middleware.wifi.wifi_bt_config.template.MIMXRT595S",
        "middleware.fatfs.template_usb.MIMXRT595S",
        "component.wifi_bt_module.config.MIMXRT595S",
        "middleware.edgefast_bluetooth.config.template.MIMXRT595S",
        "middleware.usb.host.ip3516hs_config_header.MIMXRT595S",
        "middleware.lwip.template.MIMXRT595S",
        "middleware.edgefast_bluetooth.template.MIMXRT595S",
        "middleware.wifi.template.MIMXRT595S",
        "project_template.evkmimxrt595.MIMXRT595S",
        "project_template.MIMXRT595S.MIMXRT595S",
        "middleware.freertos-kernel.MIMXRT595S",
        "middleware.freertos-kernel.heap_4.MIMXRT595S",
        "platform.utilities.misc_utilities.MIMXRT595S",
    ],
    device_core = "cm33_MIMXRT595S",
    copts = [
        "-Wno-cast-qual",
        "-Wno-redundant-decls",
        "-Wno-undef",
        "-Wno-unused-parameter",
        "-Wno-unused-variable",
        "-Wno-error=strict-prototypes",
        "-Wno-sign-compare",
        "-Wno-shadow",
        "-Wno-unused-function",
        "-include", "$(execpath @pigweed//third_party/mcuxpresso:config/app_bluetooth_config.h)"
    ],
    deps = [
        "@pigweed//third_party/mcuxpresso:config/app_bluetooth_config.h",
        ":conf",
        "@pigweed//targets/mimxrt595_evk_freertos:freertos_config",
        "@freertos",
    ],
)

